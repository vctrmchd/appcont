<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestão de Clientes - Sorria/Medic</title>
  
  <!-- Materialize CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <style>
    body {
      display: flex;
      min-height: 100vh;
      flex-direction: column;
      background-color: #f5f5f5;
    }
    main {
      flex: 1 0 auto;
    }
    .nav-wrapper {
      padding-left: 20px;
      padding-right: 20px;
    }
    .container {
      margin-top: 30px;
    }
    .card {
      border-radius: 8px;
    }
    .card-title {
      font-weight: 500 !important;
    }
    .btn-floating {
      margin-right: 10px;
    }
    .section-title {
      font-size: 1.8rem;
      font-weight: 400;
      margin-bottom: 20px;
      color: #424242;
    }
    .stat-card {
      padding: 20px;
      text-align: center;
    }
    .stat-number {
      font-size: 2.5rem;
      font-weight: 300;
      color: #1976d2;
    }
    .stat-label {
      font-size: 1rem;
      color: #757575;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .hidden {
      display: none !important;
    }
    .cliente-row {
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .cliente-row:hover {
      background-color: #e3f2fd;
    }
    .btn-small {
      margin: 2px;
    }
    .collection-item {
      padding: 10px 20px !important;
    }
    .modal {
      max-height: 90%;
      max-width: 900px;
    }
    .modal .modal-content {
      padding: 24px;
    }
    .input-field {
      margin-bottom: 20px;
    }
    .row {
      margin-bottom: 10px;
    }
    .badge {
      border-radius: 12px;
    }
    .dropdown-content li > a {
      color: #424242 !important;
      display: flex !important;
      align-items: center;
    }
    .dropdown-content li > a > i {
      margin-right: 10px;
      color: #757575;
    }
    .dropdown-content li:hover {
      background-color: #f5f5f5;
    }
    #viewClienteModal {
      max-width: 1200px;
      width: 95%;
      max-height: 95%;
    }
    #viewClienteModal .modal-content {
      padding: 30px;
      max-height: calc(95vh - 100px);
      overflow-y: auto;
    }
    .info-section {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .info-section h6 {
      color: #1976d2;
      font-weight: 500;
      margin-bottom: 20px;
      font-size: 18px;
      border-bottom: 2px solid #1976d2;
      padding-bottom: 10px;
    }
    .info-row {
      display: flex;
      margin-bottom: 15px;
      align-items: flex-start;
    }
    .info-label {
      font-weight: 600;
      color: #424242;
      min-width: 200px;
      display: flex;
      align-items: center;
    }
    .info-label i {
      margin-right: 8px;
      font-size: 18px;
      color: #757575;
    }
    .info-value {
      color: #616161;
      flex: 1;
    }
    .status-badge {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .status-ok {
      background: #4caf50;
      color: white;
    }
    .status-pendente {
      background: #ff9800;
      color: white;
    }
    .status-irregular {
      background: #f44336;
      color: white;
    }
    .status-ativo {
      background: #4caf50;
      color: white;
    }
    .status-inativo {
      background: #ff9800;
      color: white;
    }
    .status-baixada {
      background: #f44336;
      color: white;
    }
    .obs-box {
      background: #f5f5f5;
      border-left: 4px solid #2196f3;
      padding: 15px;
      border-radius: 4px;
      margin-top: 10px;
    }
    .alert-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      border-radius: 4px;
      margin-top: 10px;
    }
    #clienteModal {
      max-width: 1200px;
      width: 95%;
      max-height: 95%;
    }
    #clienteModal .modal-content {
      padding: 30px;
      max-height: calc(95vh - 100px);
      overflow-y: auto;
    }
    .form-section {
      background: #fff;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-left: 4px solid #1976d2;
    }
    .form-section h6 {
      color: #1976d2;
      font-weight: 500;
      margin: 0 0 20px 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-section h6 i {
      font-size: 24px;
    }
    .form-header {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      color: white;
      padding: 25px 30px;
      margin: -30px -30px 30px -30px;
      border-radius: 8px 8px 0 0;
    }
    .form-header h4 {
      margin: 0;
      font-weight: 500;
      font-size: 28px;
    }
    
    /* Notificações */
    .notification-badge {
      position: relative;
      display: inline-block;
    }
    .notification-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #f44336;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 11px;
      font-weight: bold;
      min-width: 18px;
      text-align: center;
    }
    .notification-item {
      padding: 15px 20px;
      border-bottom: 1px solid #e0e0e0;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .notification-item:hover {
      background-color: #f5f5f5;
    }
    .notification-item.unread {
      background-color: #e3f2fd;
    }
    .notification-item .notification-title {
      font-weight: 600;
      color: #424242;
      margin-bottom: 5px;
    }
    .notification-item .notification-message {
      color: #757575;
      font-size: 14px;
      margin-bottom: 5px;
    }
    .notification-item .notification-time {
      color: #9e9e9e;
      font-size: 12px;
    }
    .notification-icon {
      display: inline-block;
      margin-right: 10px;
      vertical-align: middle;
    }
    .notification-icon.warning {
      color: #ff9800;
    }
    .notification-icon.danger {
      color: #f44336;
    }
    .notification-icon.info {
      color: #2196f3;
    }
    #notificationsDropdown {
      max-width: 400px;
      max-height: 500px;
      overflow-y: auto;
    }
    .notification-header {
      padding: 15px 20px;
      background: #1976d2;
      color: white;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .notification-empty {
      padding: 40px 20px;
      text-align: center;
      color: #9e9e9e;
    }
    
    /* Histórico de Alterações */
    .timeline {
      position: relative;
      padding: 20px 0;
    }
    .timeline-item {
      position: relative;
      padding-left: 50px;
      padding-bottom: 30px;
    }
    .timeline-item:last-child {
      padding-bottom: 0;
    }
    .timeline-item::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 0;
      bottom: -30px;
      width: 2px;
      background: #e0e0e0;
    }
    .timeline-item:last-child::before {
      display: none;
    }
    .timeline-icon {
      position: absolute;
      left: 0;
      top: 0;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #1976d2;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      z-index: 1;
    }
    .timeline-icon.create {
      background: #4caf50;
    }
    .timeline-icon.edit {
      background: #2196f3;
    }
    .timeline-icon.delete {
      background: #f44336;
    }
    .timeline-content {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .timeline-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .timeline-title {
      font-weight: 600;
      color: #424242;
    }
    .timeline-time {
      color: #9e9e9e;
      font-size: 12px;
    }
    .timeline-user {
      color: #757575;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .timeline-changes {
      background: #f5f5f5;
      border-left: 3px solid #1976d2;
      padding: 10px;
      border-radius: 4px;
      font-size: 14px;
    }
    .timeline-change-item {
      margin-bottom: 5px;
    }
    .timeline-change-item:last-child {
      margin-bottom: 0;
    }
    .timeline-change-label {
      font-weight: 600;
      color: #424242;
    }
    .timeline-change-old {
      color: #f44336;
      text-decoration: line-through;
    }
    .timeline-change-new {
      color: #4caf50;
      font-weight: 500;
    }
    #historicoModal {
      max-width: 900px;
      width: 90%;
    }
    #historicoModal .modal-content {
      max-height: calc(90vh - 100px);
      overflow-y: auto;
    }
    
    /* Comentários */
    .comentarios-section {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .comentarios-section h6 {
      color: #1976d2;
      font-weight: 500;
      margin-bottom: 20px;
      font-size: 18px;
      border-bottom: 2px solid #1976d2;
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .comentario-form {
      background: #f5f5f5;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    .comentario-form textarea {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      padding: 12px;
      width: 100%;
      min-height: 80px;
      font-family: inherit;
      font-size: 14px;
      resize: vertical;
      margin-bottom: 10px;
    }
    .comentario-form textarea:focus {
      outline: none;
      border-color: #1976d2;
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
    }
    .comentarios-lista {
      max-height: 400px;
      overflow-y: auto;
    }
    .comentario-item {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      position: relative;
      transition: box-shadow 0.2s;
    }
    .comentario-item:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .comentario-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }
    .comentario-autor {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .comentario-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #1976d2, #1565c0);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 16px;
    }
    .comentario-autor-info {
      display: flex;
      flex-direction: column;
    }
    .comentario-nome {
      font-weight: 600;
      color: #424242;
      font-size: 14px;
    }
    .comentario-email {
      font-size: 12px;
      color: #757575;
    }
    .comentario-data {
      font-size: 12px;
      color: #9e9e9e;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .comentario-editado {
      font-size: 11px;
      color: #9e9e9e;
      font-style: italic;
      margin-left: 5px;
    }
    .comentario-texto {
      color: #616161;
      line-height: 1.6;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin-top: 10px;
      padding: 10px;
      background: #fafafa;
      border-radius: 4px;
      border-left: 3px solid #1976d2;
    }
    .comentario-acoes {
      position: absolute;
      top: 15px;
      right: 15px;
      display: none;
    }
    .comentario-item:hover .comentario-acoes {
      display: flex;
      gap: 5px;
    }
    .comentario-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
      border-radius: 4px;
      transition: background 0.2s;
      color: #757575;
    }
    .comentario-btn:hover {
      background: #e0e0e0;
    }
    .comentario-btn i {
      font-size: 18px;
    }
    .comentario-btn.delete:hover {
      background: #ffebee;
      color: #f44336;
    }
    .comentario-btn.edit:hover {
      background: #e3f2fd;
      color: #1976d2;
    }
    .comentarios-vazio {
      text-align: center;
      padding: 40px 20px;
      color: #9e9e9e;
    }
    .comentarios-vazio i {
      font-size: 48px;
      margin-bottom: 10px;
      opacity: 0.5;
    }
    .badge-comentarios {
      background: #ff9800;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="blue darken-2">
    <div class="nav-wrapper">
      <a href="#" class="brand-logo">Gestão de Clientes</a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="#" onclick="showDashboard()"><i class="material-icons left">dashboard</i>Dashboard</a></li>
        <li><a href="#" onclick="showClientes()"><i class="material-icons left">people</i>Clientes</a></li>
        <li><a href="#" onclick="showUsuarios()"><i class="material-icons left">person</i>Usuários</a></li>
        <li><a href="#" onclick="showAuditoria()"><i class="material-icons left">history</i>Auditoria</a></li>
        <li class="notification-badge">
          <a href="#!" class="dropdown-trigger" data-target="notificationsDropdown">
            <i class="material-icons">notifications</i>
            <span class="notification-count" id="notificationCount" style="display: none;">0</span>
          </a>
        </li>
        <li><a href="#" id="userEmailDisplay">Carregando...</a></li>
      </ul>
    </div>
  </nav>

  <!-- Dropdown de Notificações -->
  <ul id="notificationsDropdown" class="dropdown-content">
    <li class="notification-header">
      <span>Notificações</span>
      <a href="#!" onclick="marcarTodasLidas()" style="color: white; font-size: 12px; text-decoration: underline;">Marcar todas como lidas</a>
    </li>
    <li><div id="notificationsList"></div></li>
  </ul>

  <main>
    <div class="container">
      <!-- Dashboard Section -->
      <div id="dashboardSection" class="section">
        <h4 class="section-title">Dashboard</h4>
        <div class="row">
          <div class="col s12 m6 l3">
            <div class="card stat-card">
              <div class="stat-number" id="totalClientes">0</div>
              <div class="stat-label">Total de Clientes</div>
            </div>
          </div>
          <div class="col s12 m6 l3">
            <div class="card stat-card">
              <div class="stat-number" id="clientesAtivos">0</div>
              <div class="stat-label">Clientes Ativos</div>
            </div>
          </div>
          <div class="col s12 m6 l3">
            <div class="card stat-card">
              <div class="stat-number" id="clientesVencimento">0</div>
              <div class="stat-label">Vencimentos Próximos</div>
            </div>
          </div>
          <div class="col s12 m6 l3">
            <div class="card stat-card">
              <div class="stat-number" id="clientesPendencia">0</div>
              <div class="stat-label">Pendências Fiscais</div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col s12 m6">
            <div class="card">
              <div class="card-content">
                <span class="card-title">Clientes por Empresa</span>
                <div id="clientesPorEmpresa"></div>
              </div>
            </div>
          </div>
          <div class="col s12 m6">
            <div class="card">
              <div class="card-content">
                <span class="card-title">Clientes por Tributação</span>
                <div id="clientesPorTributacao"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Clientes Section -->
      <div id="clientesSection" class="section hidden">
        <div class="row" style="margin-bottom: 20px; align-items: center;">
          <div class="col s12 m6">
            <h4 class="section-title" style="margin: 0;">Clientes</h4>
          </div>
          <div class="col s12 m6 right-align">
            <a class="btn waves-effect waves-light blue" onclick="openNovoClienteModal()">
              <i class="material-icons left">add</i>Novo Cliente
            </a>
          </div>
        </div>
        <div class="row">
          <div class="col s12">
            <div class="card">
              <div class="card-content">
                <div class="row" style="margin-bottom: 10px;">
                  <div class="col s12 m6 l5">
                    <div class="input-field" style="margin-top: 0;">
                      <i class="material-icons prefix">search</i>
                      <input id="searchCliente" type="text" onkeyup="filterClientesDebounced()">
                      <label for="searchCliente">Buscar por Razão Social ou CPF/CNPJ</label>
                    </div>
                  </div>
                  <div class="col s12 m6 l7 right-align" style="padding-top: 10px;">
                    <a class="btn-flat waves-effect waves-light" onclick="toggleFiltros()" style="margin-right: 10px;">
                      <i class="material-icons left">filter_list</i>Filtros
                    </a>
                    <a class="dropdown-trigger btn-flat waves-effect waves-light green-text" href="#!" data-target="dropdownExportar">
                      <i class="material-icons left">file_download</i>Exportar<i class="material-icons right">arrow_drop_down</i>
                    </a>
                    <ul id="dropdownExportar" class="dropdown-content">
                      <li><a href="#!" onclick="exportarCSV()"><i class="material-icons left">description</i>CSV</a></li>
                      <li><a href="#!" onclick="exportarExcel()"><i class="material-icons left">table_chart</i>Excel</a></li>
                    </ul>
                  </div>
                </div>
                
                <!-- Painel de Filtros Avançados -->
                <div id="filtrosAvancados" class="row" style="display: none; background: #f5f5f5; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                  <div class="col s12 m4">
                    <div class="input-field">
                      <select id="filtroEmpresa" onchange="aplicarFiltros()">
                        <option value="">Todas</option>
                        <option value="Sorria">Sorria</option>
                        <option value="Medic">Medic</option>
                      </select>
                      <label>Empresa</label>
                    </div>
                  </div>
                  <div class="col s12 m4">
                    <div class="input-field">
                      <select id="filtroSituacao" onchange="aplicarFiltros()">
                        <option value="">Todas</option>
                        <option value="Ativo">Ativo</option>
                        <option value="Inativo">Inativo</option>
                        <option value="Baixada">Baixada</option>
                      </select>
                      <label>Situação</label>
                    </div>
                  </div>
                  <div class="col s12 m4">
                    <div class="input-field">
                      <select id="filtroTributacao" onchange="aplicarFiltros()">
                        <option value="">Todos</option>
                        <option value="Simples Nacional">Simples Nacional</option>
                        <option value="Lucro Presumido">Lucro Presumido</option>
                        <option value="Lucro Real">Lucro Real</option>
                        <option value="MEI">MEI</option>
                      </select>
                      <label>Regime de Tributação</label>
                    </div>
                  </div>
                  <div class="col s12 m4">
                    <div class="input-field">
                      <select id="filtroUF" onchange="aplicarFiltros()">
                        <option value="">Todos</option>
                        <option value="AC">AC</option>
                        <option value="AL">AL</option>
                        <option value="AP">AP</option>
                        <option value="AM">AM</option>
                        <option value="BA">BA</option>
                        <option value="CE">CE</option>
                        <option value="DF">DF</option>
                        <option value="ES">ES</option>
                        <option value="GO">GO</option>
                        <option value="MA">MA</option>
                        <option value="MT">MT</option>
                        <option value="MS">MS</option>
                        <option value="MG">MG</option>
                        <option value="PA">PA</option>
                        <option value="PB">PB</option>
                        <option value="PR">PR</option>
                        <option value="PE">PE</option>
                        <option value="PI">PI</option>
                        <option value="RJ">RJ</option>
                        <option value="RN">RN</option>
                        <option value="RS">RS</option>
                        <option value="RO">RO</option>
                        <option value="RR">RR</option>
                        <option value="SC">SC</option>
                        <option value="SP">SP</option>
                        <option value="SE">SE</option>
                        <option value="TO">TO</option>
                      </select>
                      <label>UF</label>
                    </div>
                  </div>
                  <div class="col s12 right-align">
                    <a class="btn-flat waves-effect" onclick="limparFiltros()">Limpar Filtros</a>
                  </div>
                </div>
                <table class="striped highlight responsive-table" id="clientesTable">
                  <thead>
                    <tr>
                      <th style="cursor: pointer;" onclick="ordenarPor('id_cliente')">
                        Código <i class="material-icons tiny" style="vertical-align: middle;">unfold_more</i>
                      </th>
                      <th style="cursor: pointer;" onclick="ordenarPor('razao_social')">
                        Razão Social <i class="material-icons tiny" style="vertical-align: middle;">unfold_more</i>
                      </th>
                      <th style="cursor: pointer;" onclick="ordenarPor('cpf_cnpj')">
                        CPF/CNPJ <i class="material-icons tiny" style="vertical-align: middle;">unfold_more</i>
                      </th>
                      <th style="cursor: pointer;" onclick="ordenarPor('uf')">
                        UF <i class="material-icons tiny" style="vertical-align: middle;">unfold_more</i>
                      </th>
                      <th style="cursor: pointer;" onclick="ordenarPor('situacao')">
                        Situação <i class="material-icons tiny" style="vertical-align: middle;">unfold_more</i>
                      </th>
                      <th style="cursor: pointer;" onclick="ordenarPor('empresa_responsavel')">
                        Empresa <i class="material-icons tiny" style="vertical-align: middle;">unfold_more</i>
                      </th>
                      <th style="cursor: pointer;" onclick="ordenarPor('regime_tributacao')">
                        Regime de Tributação <i class="material-icons tiny" style="vertical-align: middle;">unfold_more</i>
                      </th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody id="clientesTableBody">
                    <tr><td colspan="8" class="center-align">Carregando...</td></tr>
                  </tbody>
                </table>
                
                <!-- Paginação -->
                <div class="row" style="margin-top: 20px;">
                  <div class="col s12 center-align">
                    <ul class="pagination" id="paginacao"></ul>
                    <p style="margin-top: 10px; color: #757575;">
                      <span id="infoPaginacao"></span>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Usuários Section -->
      <div id="usuariosSection" class="section hidden">
        <div class="row" style="margin-bottom: 20px; align-items: center;">
          <div class="col s12 m6">
            <h4 class="section-title" style="margin: 0;">Usuários</h4>
          </div>
          <div class="col s12 m6 right-align">
            <a class="btn waves-effect waves-light blue" onclick="openNovoUsuarioModal()">
              <i class="material-icons left">add</i>Novo Usuário
            </a>
          </div>
        </div>
        <div class="row">
          <div class="col s12">
            <div class="card">
              <div class="card-content">
                <div class="row" style="margin-bottom: 20px;">
                  <div class="col s12 m6">
                    <div class="input-field" style="margin-top: 0;">
                      <i class="material-icons prefix">search</i>
                      <input id="searchUsuario" type="text" onkeyup="filterUsuarios()">
                      <label for="searchUsuario">Buscar por Email ou Nome</label>
                    </div>
                  </div>
                </div>
                <table class="striped highlight responsive-table" id="usuariosTable">
                  <thead>
                    <tr>
                      <th>Email</th>
                      <th>Nome</th>
                      <th>Empresa</th>
                      <th>Papel</th>
                      <th>Ativo</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody id="usuariosTableBody">
                    <tr><td colspan="6" class="center-align">Carregando...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Auditoria Section -->
      <div id="auditoriaSection" class="section hidden">
        <h4 class="section-title">Auditoria</h4>
        <div class="row">
          <div class="col s12">
            <div class="card">
              <div class="card-content">
                <table class="striped highlight responsive-table" id="auditoriaTable">
                  <thead>
                    <tr>
                      <th>Data/Hora</th>
                      <th>Usuário</th>
                      <th>Ação</th>
                      <th>ID Cliente</th>
                      <th>Detalhes</th>
                    </tr>
                  </thead>
                  <tbody id="auditoriaTableBody">
                    <tr><td colspan="5" class="center-align">Carregando...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="page-footer blue darken-2">
    <div class="container">
      <div class="row">
        <div class="col s12 center-align">
          <p class="white-text">© 2025 Gestão de Clientes - Sorria/Medic | Versão Beta</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Modal: Novo/Editar Cliente -->
  <div id="clienteModal" class="modal modal-fixed-footer">
    <div class="modal-content">
      <div class="form-header">
        <h4 id="clienteModalTitle">Novo Cliente</h4>
        <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 14px;">Preencha os dados do cliente</p>
      </div>
      
      <form id="clienteForm">
        
        <!-- Informações Básicas -->
        <div class="form-section">
          <h6>
            <i class="material-icons">business</i>
            Informações Básicas
          </h6>
          
          <div class="row">
            <div class="input-field col s12 m6">
              <input id="razao_social" type="text" required>
              <label for="razao_social">Razão Social *</label>
            </div>
            <div class="input-field col s12 m6">
              <input id="cpf_cnpj" type="text" required maxlength="18" onblur="validarCampoCpfCnpj(this)">
              <label for="cpf_cnpj">CPF/CNPJ *</label>
              <span id="cpf_cnpj_error" style="color: #f44336; font-size: 12px; display: none;"></span>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12 m6">
              <select id="empresa_responsavel" required>
                <option value="" disabled selected>Escolha uma empresa</option>
                <option value="Sorria">Sorria</option>
                <option value="Medic">Medic</option>
              </select>
              <label>Empresa Responsável *</label>
            </div>
            <div class="input-field col s12 m6">
              <input id="squad" type="text" required>
              <label for="squad">Squad *</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12 m8">
              <input id="municipio" type="text" required>
              <label for="municipio">Município *</label>
            </div>
            <div class="input-field col s12 m4">
              <select id="uf" required>
                <option value="" disabled selected>UF</option>
                <option value="AC">AC</option>
                <option value="AL">AL</option>
                <option value="AP">AP</option>
                <option value="AM">AM</option>
                <option value="BA">BA</option>
                <option value="CE">CE</option>
                <option value="DF">DF</option>
                <option value="ES">ES</option>
                <option value="GO">GO</option>
                <option value="MA">MA</option>
                <option value="MT">MT</option>
                <option value="MS">MS</option>
                <option value="MG">MG</option>
                <option value="PA">PA</option>
                <option value="PB">PB</option>
                <option value="PR">PR</option>
                <option value="PE">PE</option>
                <option value="PI">PI</option>
                <option value="RJ">RJ</option>
                <option value="RN">RN</option>
                <option value="RS">RS</option>
                <option value="RO">RO</option>
                <option value="RR">RR</option>
                <option value="SC">SC</option>
                <option value="SP">SP</option>
                <option value="SE">SE</option>
                <option value="TO">TO</option>
              </select>
              <label>UF *</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12 m6">
              <select id="situacao" required>
                <option value="" disabled selected>Escolha a situação</option>
                <option value="Ativo">Ativo</option>
                <option value="Inativo">Inativo</option>
                <option value="Baixada">Baixada</option>
              </select>
              <label>Situação *</label>
            </div>
            <div class="input-field col s12 m6">
              <input id="faturamento" type="number" step="0.01" min="0">
              <label for="faturamento">Faturamento (R$)</label>
            </div>
          </div>
        </div>

        <!-- Informações Fiscais -->
        <div class="form-section">
          <h6>
            <i class="material-icons">account_balance</i>
            Informações Fiscais
          </h6>

          <div class="row">
            <div class="input-field col s12 m6">
              <select id="regime_tributacao">
                <option value="" disabled selected>Escolha o regime</option>
                <option value="Simples Nacional">Simples Nacional</option>
                <option value="Lucro Presumido">Lucro Presumido</option>
                <option value="Lucro Real">Lucro Real</option>
                <option value="MEI">MEI</option>
              </select>
              <label>Regime de Tributação</label>
            </div>
            <div class="input-field col s12 m6">
              <select id="status_parcelamento">
                <option value="" disabled selected>Escolha</option>
                <option value="SIM">SIM</option>
                <option value="NÃO">NÃO</option>
              </select>
              <label>Status Parcelamento</label>
            </div>
          </div>
        </div>

        <!-- Datas Importantes -->
        <div class="form-section">
          <h6>
            <i class="material-icons">event</i>
            Datas Importantes
          </h6>

          <div class="row">
            <div class="input-field col s12 m4">
              <input id="data_entrada" type="date">
              <label for="data_entrada" class="active">Data de Entrada</label>
            </div>
            <div class="input-field col s12 m4">
              <input id="data_constituicao" type="date">
              <label for="data_constituicao" class="active">Data de Constituição</label>
            </div>
            <div class="input-field col s12 m4">
              <input id="ultima_consulta_fiscal" type="date">
              <label for="ultima_consulta_fiscal" class="active">Última Consulta Fiscal</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12 m4">
              <input id="vencimento_iss" type="date">
              <label for="vencimento_iss" class="active">Vencimento ISS</label>
            </div>
            <div class="input-field col s12 m4">
              <input id="prazo_efd_reinf" type="date">
              <label for="prazo_efd_reinf" class="active">Prazo EFD-Reinf</label>
            </div>
            <div class="input-field col s12 m4">
              <input id="prazo_fechamento" type="date">
              <label for="prazo_fechamento" class="active">Prazo Fechamento</label>
            </div>
          </div>
        </div>

        <!-- Status de Regularidade -->
        <div class="form-section">
          <h6>
            <i class="material-icons">verified_user</i>
            Status de Regularidade
          </h6>

          <div class="row">
            <div class="input-field col s12 m6">
              <select id="status_regularidade_federal">
                <option value="" disabled selected>Escolha</option>
                <option value="OK">OK</option>
                <option value="PENDENTE">PENDENTE</option>
                <option value="IRREGULAR">IRREGULAR</option>
              </select>
              <label>Regularidade Federal</label>
            </div>
            <div class="input-field col s12 m6">
              <select id="status_regularidade_municipal">
                <option value="" disabled selected>Escolha</option>
                <option value="OK">OK</option>
                <option value="PENDENTE">PENDENTE</option>
                <option value="IRREGULAR">IRREGULAR</option>
              </select>
              <label>Regularidade Municipal</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12 m6">
              <select id="status_regularidade_estadual">
                <option value="" disabled selected>Escolha</option>
                <option value="OK">OK</option>
                <option value="PENDENTE">PENDENTE</option>
                <option value="IRREGULAR">IRREGULAR</option>
              </select>
              <label>Regularidade Estadual</label>
            </div>
            <div class="input-field col s12 m6">
              <select id="status_regularidade_conselho">
                <option value="" disabled selected>Escolha</option>
                <option value="OK">OK</option>
                <option value="PENDENTE">PENDENTE</option>
                <option value="IRREGULAR">IRREGULAR</option>
              </select>
              <label>Regularidade Conselho</label>
            </div>
          </div>

          <div class="row">
            <div class="input-field col s12">
              <textarea id="observacoes_regularidade" class="materialize-textarea"></textarea>
              <label for="observacoes_regularidade">Observações de Regularidade</label>
            </div>
          </div>
        </div>

        
        <input type="hidden" id="cliente_id">
      </form>
    </div>
    <div class="modal-footer" style="padding: 20px 30px; background: #f5f5f5;">
      <a href="#!" class="modal-close waves-effect waves-red btn-flat" style="margin-right: 10px;">
        <i class="material-icons left">close</i>Cancelar
      </a>
      <a href="#!" class="waves-effect waves-green btn blue" onclick="salvarCliente()">
        <i class="material-icons left">save</i>Salvar Cliente
      </a>
    </div>
  </div>

  <!-- Modal: Visualizar Cliente -->
  <div id="viewClienteModal" class="modal modal-fixed-footer">
    <div class="modal-content">
      <div id="clienteDetalhes"></div>
    </div>
    <div class="modal-footer">
      <a href="#!" class="waves-effect waves-green btn blue" onclick="verHistoricoCliente()" style="margin-right: 10px;">
        <i class="material-icons left">history</i>Histórico
      </a>
      <a href="#!" class="waves-effect waves-green btn green" onclick="editarClienteDoModal()" style="margin-right: 10px;">
        <i class="material-icons left">edit</i>Editar
      </a>
      <a href="#!" class="waves-effect waves-red btn red" onclick="deletarClienteDoModal()" style="margin-right: 10px;">
        <i class="material-icons left">delete</i>Excluir
      </a>
      <a href="#!" class="modal-close waves-effect waves-grey btn-flat">Fechar</a>
    </div>
  </div>

  <!-- Modal: Histórico de Alterações -->
  <div id="historicoModal" class="modal">
    <div class="modal-content">
      <h4 style="color: #1976d2; margin-bottom: 20px;">
        <i class="material-icons" style="vertical-align: middle;">history</i>
        Histórico de Alterações
      </h4>
      <div id="historicoContent">
        <div class="center-align" style="padding: 40px;">
          <div class="preloader-wrapper active">
            <div class="spinner-layer spinner-blue-only">
              <div class="circle-clipper left">
                <div class="circle"></div>
              </div>
              <div class="gap-patch">
                <div class="circle"></div>
              </div>
              <div class="circle-clipper right">
                <div class="circle"></div>
              </div>
            </div>
          </div>
          <p style="margin-top: 20px; color: #757575;">Carregando histórico...</p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close waves-effect waves-grey btn-flat">Fechar</a>
    </div>
  </div>

  <!-- Materialize JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js" defer></script>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>

  <!-- Configuração Supabase -->
  <script src="supabase-config.js" defer></script>

  <!-- Lógica da Aplicação -->
  <script src="app.js" defer></script>
</body>
</html>